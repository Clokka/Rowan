<!-- shop.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shop - CLOKKA</title>
  <style>
    /* [Same styles as before, unchanged] */
  </style>
</head>
<body>

  <header>
    <div class="header-left">
      <img src="https://i.imgur.com/VtMMSyI.png" alt="CLOKKA Red Logo" />
      <h1>CLOKKA Shop</h1>
    </div>
    <div class="basket-icon" onclick="window.location.href='cart.html'" title="Go to Basket" aria-label="Cart with item count">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" width="24" height="24">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
      <div id="cart-count" class="cart-count-badge" style="display:none">0</div>
    </div>
  </header>

  <!-- [Sort Dropdown & Product Grid remain unchanged] -->

  <!-- [New Products, Review Form unchanged] -->

  <!-- âœ… Script with cart integration -->
  <script>
    function getCartItems() {
      const cart = localStorage.getItem('cart');
      return cart ? JSON.parse(cart) : [];
    }

    function saveCartItems(cartItems) {
      localStorage.setItem('cart', JSON.stringify(cartItems));
    }

    function addToCart(product) {
      const cart = getCartItems();
      const existing = cart.find(item => item.id === product.id);
      if (existing) {
        existing.quantity += 1;
      } else {
        product.quantity = 1;
        cart.push(product);
      }
      saveCartItems(cart);
      updateCartCount(cart.reduce((sum, item) => sum + item.quantity, 0));
    }

    function updateCartCount(count) {
      const cartCountEl = document.getElementById('cart-count');
      if (count > 0) {
        cartCountEl.style.display = 'flex';
        cartCountEl.textContent = count;
      } else {
        cartCountEl.style.display = 'none';
      }
    }

    // Initialize cart count on page load
    updateCartCount(getCartItems().reduce((sum, item) => sum + item.quantity, 0));

    // Sorting logic (unchanged)
    const sortSelect = document.getElementById('sort-select');
    const productGrid = document.getElementById('product-grid');

    function sortProducts(criteria) {
      const products = Array.from(productGrid.children);
      products.sort((a, b) => {
        switch (criteria) {
          case 'newest':
            return new Date(b.dataset.date) - new Date(a.dataset.date);
          case 'price-low':
            return parseFloat(a.dataset.price) - parseFloat(b.dataset.price);
          case 'price-high':
            return parseFloat(b.dataset.price) - parseFloat(a.dataset.price);
          case 'bestselling':
            return parseInt(b.dataset.sales) - parseInt(a.dataset.sales);
          default:
            return 0;
        }
      });
      products.forEach(prod => productGrid.appendChild(prod));
    }

    sortSelect.addEventListener('change', () => sortProducts(sortSelect.value));
    sortProducts(sortSelect.value);

    // Attach "Add to Basket" functionality
    document.querySelectorAll('.add-to-basket').forEach(button => {
      button.addEventListener('click', () => {
        const productEl = button.closest('.product');
        const name = productEl.querySelector('h3').textContent.trim();
        const price = parseFloat(productEl.dataset.price);
        const image = productEl.querySelector('img').src;
        const id = name.toLowerCase().replace(/\s+/g, '-');

        const product = { id, name, price, image };
        addToCart(product);
      });
    });
  </script>
</body>
</html>
